# ----- Etapa 1: Construcción (Builder) -----
# Usamos una imagen de Node para instalar dependencias y construir el proyecto
FROM node:18-alpine AS builder

# Establecemos el directorio de trabajo dentro del contenedor
WORKDIR /app

# Copiamos el package.json y package-lock.json primero para cachear las dependencias
COPY package*.json ./
RUN npm install

# Copiamos el resto del código fuente
COPY . .

# Creamos la versión de producción
RUN npm run build

# ----- Etapa 2: Producción (Final) -----
# Partimos de una imagen limpia de Nginx (¡la que tú tienes!)
FROM nginx:alpine

# Copiamos el archivo de configuración de Nginx personalizado
COPY nginx.conf /etc/nginx/conf.d/default.conf

# Copiamos los archivos estáticos (la carpeta 'build') desde la etapa 'builder'
# al directorio donde Nginx sirve los archivos
COPY --from=builder /app/build /usr/share/nginx/html

# Exponemos el puerto 80 (que Nginx usa por defecto)
EXPOSE 80